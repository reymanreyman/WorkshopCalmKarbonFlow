
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Calm: 3TWA Blueprint</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Calm: Marketplace" href="../calm_marketplace/calm_marketplace.html" />
    <link rel="prev" title="Calm: MySQL Blueprint" href="../calm_mysql_blueprint/calm_mysql_blueprint.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

<link href="http://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  </head><body>

  <div id="navbar" class="navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/NutanixWorkshops.svg"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html"> <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Technology Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_nutanix/what_is_nutanix.html">What is Nutanix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../what_is_nutanix/what_is_nutanix.html#what-is-nutanix-enterprise-os">What is Nutanix Enterprise OS?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../what_is_nutanix/what_is_nutanix.html#streamlining-the-datacenter">Streamlining The Datacenter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_nutanix/what_is_nutanix.html#nutanix-web-scale-architecture">Nutanix Web-Scale Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_nutanix/what_is_nutanix.html#the-nutanix-solution">The Nutanix Solution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_nutanix/what_is_nutanix.html#prism-central-management">Prism Central Management</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Nutanix Calm</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_calm/what_is_calm.html">What Is Calm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../what_is_calm/what_is_calm.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what_is_calm/what_is_calm.html#what-is-the-state-of-things-today">What is the State of Things Today</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../what_is_calm/what_is_calm.html#managing-apps-is-increasingly-challenging">Managing Apps Is Increasingly Challenging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../what_is_calm/what_is_calm.html#how-does-nutanix-solve-this-problem">How Does Nutanix Solve This Problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../what_is_calm/what_is_calm.html#foundation-for-enterprise-cloud">Foundation For Enterprise Cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_calm/what_is_calm.html#delivering-the-enterprise-cloud-vision">Delivering the Enterprise Cloud Vision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_calm/what_is_calm.html#self-service-and-governance">Self-Service and Governance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#marketplace">Marketplace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#partners">Partners</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#user-case-1-self-service-app-provisioning">User Case 1: Self-Service App Provisioning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#user-case-2-self-service-via-servicenow-calm">User Case 2: Self-Service via ServiceNow &amp; Calm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#role-based-access-control">Role-Based Access Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#end-to-end-audits">End-to-End Audits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#on-prem-resource-cost">On-Prem Resource Cost</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_calm/what_is_calm.html#application-lifecycle-management">Application Lifecycle Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#calm-blueprints">Calm Blueprints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#kubernetes-with-calm">Kubernetes with Calm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#use-case-3-application-life-cycle-management">Use Case 3: Application Life Cycle Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#use-case-4-ci-cd-using-calm-and-jenkins">Use Case 4: CI/CD using Calm and Jenkins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_calm/what_is_calm.html#multi-cloud-orchestration">Multi-Cloud Orchestration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#define-apps-once-use-everywhere-with-profiles">Define Apps Once, Use Everywhere with Profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../what_is_calm/what_is_calm.html#compare-cloud-costs-and-predict-future-spend">Compare Cloud Costs and Predict Future Spend</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../what_is_calm/what_is_calm.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calm_basics/basics.html">Calm Basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_basics/basics.html#accessing-calm">Accessing Calm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_basics/basics.html#tabbed-navigation">Tabbed Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_basics/basics.html#blueprint-editor">Blueprint Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_basics/basics.html#glossary">Glossary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#project">Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#blueprint">Blueprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#id2">Blueprint Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#service">Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#pod">Pod</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#action">Action</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#application-profile">Application Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#dependency">Dependency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#macro">Macro</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#application">Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#application-overview">Application Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#task-library">Task Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#marketplace">Marketplace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_basics/basics.html#takeaways">Takeaways</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Nutanix Calm Lab</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../calm_projects/calm_projects.html">Calm: Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_projects/calm_projects.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_projects/calm_projects.html#creating-a-project">Creating A Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_projects/calm_projects.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html">Calm: SSH Key Creation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#macos-linux">MacOS / Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#ssh-key-creation">SSH Key Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#accessing-the-private-key">Accessing the Private Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#accessing-the-public-key">Accessing the Public Key</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#windows">Windows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#id1">SSH Key Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#id2">Accessing the Private Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#id3">Accessing the Public Key</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html">Calm: Single VM Blueprint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#creating-single-vm-blueprint-centos">Creating Single VM Blueprint (CentOS)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#creating-blueprint">Creating Blueprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#blueprint-settings">Blueprint Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#vm-details">VM Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#variables">Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#vm-configuration">VM Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#launching-the-blueprint">Launching the Blueprint</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html">Calm: MySQL Blueprint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html#creating-blueprint-mysql">Creating Blueprint (MySQL)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html#setting-variables">Setting Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html#adding-a-downloadable-image">Adding a Downloadable Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html#adding-db-service">Adding DB Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html#launching-the-blueprint">Launching the Blueprint</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Calm: 3TWA Blueprint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calm-blueprint-3twa">Calm Blueprint (3TWA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-web-server">Creating the Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-dependencies">Adding Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-replicas">Adding Replicas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-load-balancer">Creating the Load Balancer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scale-out">Scale Out</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scale-in">Scale In</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launching-and-managing-the-application">Launching and Managing the Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html">Calm: Marketplace</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#calm-marketplace-part-1">Calm Marketplace Part 1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#publishing-blueprints-from-marketplace-manager">Publishing Blueprints from Marketplace Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#cloning-blueprints-from-marketplace">Cloning Blueprints from Marketplace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#editing-cloned-blueprint">Editing Cloned Blueprint</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#calm-marketplace-part-2">Calm Marketplace Part 2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#publishing-blueprints">Publishing Blueprints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#approving-blueprints">Approving Blueprints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#configuring-project-environment">Configuring Project Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#launching-blueprint-from-the-marketplace">Launching Blueprint from the Marketplace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html#takeaways">Takeaways</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Optional Flow Lab</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_flow/what_is_flow.html">What Is Flow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../what_is_flow/what_is_flow.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what_is_flow/what_is_flow.html#what-is-the-state-of-things-today">What is the State of Things Today</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#why-microsegmentation">Why Microsegmentation?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#securing-hci-with-flow-microsegmentation">Securing HCI with Flow + Microsegmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#flow-under-the-hood">Flow: Under the hood</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#why-flow">Why Flow?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#use-case-app-segmentation">Use Case: App Segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#use-case-vdi-microsegmentation">Use Case: VDI Microsegmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#use-case-network-security-automation">Use Case: Network &amp; Security Automation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#isolation-policy">Isolation Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#application-security-policy">Application Security Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../what_is_flow/what_is_flow.html#quarantine-policy">Quarantine Policy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flow_enable/flow_enable.html">Flow: Enable and Lab Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../flow_enable/flow_enable.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow_enable/flow_enable.html#enabling-microsegmentation">Enabling Microsegmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow_enable/flow_enable.html#create-five-vms">Create Five VMs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../flow_enable/flow_enable.html#clone-the-other-four-vms">Clone the other four VMs:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../flow_enable/flow_enable.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flow_quarantine_vm/flow_quarantine_vm.html">Flow: Quarantine VM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../flow_quarantine_vm/flow_quarantine_vm.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow_quarantine_vm/flow_quarantine_vm.html#quarantine-a-vm-and-explore-the-quarantine-policy">Quarantine a VM and Explore the Quarantine Policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../flow_quarantine_vm/flow_quarantine_vm.html#confirm-communication-between-flow-abc-1-and-flow-abc-2">Confirm Communication between flow-abc-1 and flow-abc-2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../flow_quarantine_vm/flow_quarantine_vm.html#quarantine-a-vm-and-edit-the-quarantine-policy">Quarantine a VM and Edit The Quarantine Policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../flow_quarantine_vm/flow_quarantine_vm.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html">Flow: Isolate Environments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#isolate-environments-with-flow">Isolate Environments with Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#create-a-new-category">Create a New Category</a></li>
<li class="toctree-l3"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#create-a-new-security-policy">Create a New Security Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#apply-the-new-security-policy">Apply the New Security Policy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#confirm-communication-is-possible-before-applying-the-categories-to-the-vms">Confirm communication is possible before applying the categories to the VMs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#assign-a-category-to-the-vms-flow-abc-3-and-flow-abc-4">Assign a category to the VMs flow-abc-3 and flow-abc-4</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#confirm-communication-is-not-possible-after-applying-the-categories-to-the-vms">Confirm communication is NOT possible after applying the categories to the VMs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html">Flow: Secure App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#secure-applications-with-microsegmentation">Secure Applications with Microsegmentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#create-and-assign-categories">Create and Assign Categories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#update-apptype-with-new-category-value-app-abc">Update <strong>AppType</strong> with New Category Value <strong>app-abc</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#assign-vm-flow-abc-5-to-the-category-apptype-app-abc">Assign VM <strong>flow-abc-5</strong> to the category <strong>AppType: app-abc</strong>.</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#assign-vm-flow-abc-1-the-default-category-environment-dev">Assign VM <strong>flow-abc-1</strong> the default category <strong>Environment: Dev</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#secure-the-application-vm">Secure the Application VM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#create-a-new-security-policy-to-protect-the-app-abc-application">Create a new security policy to protect the <strong>app-abc</strong> application.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flow_visualization/flow_visualization.html">Flow: Visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../flow_visualization/flow_visualization.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow_visualization/flow_visualization.html#id2">Flow Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../flow_visualization/flow_visualization.html#add-flows-to-a-policy-using-flow-visualization">Add Flows to a Policy Using Flow Visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../flow_visualization/flow_visualization.html#view-the-detected-traffic-flows-from-environment-dev">View the detected traffic flows from Environment: Dev</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_visualization/flow_visualization.html#add-the-detected-flow-to-the-security-policy">Add The Detected Flow to The Security Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../flow_visualization/flow_visualization.html#move-policy-from-monitoring-mode-to-applied-mode">Move Policy from <strong>Monitoring</strong> Mode to <strong>Applied</strong> Mode</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../flow_visualization/flow_visualization.html#takeaways">Takeaways</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Optional Labs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../calm_enable/calm_enable.html">Calm: Enable</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_enable/calm_enable.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_enable/calm_enable.html#enabling-app-management">Enabling App Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_enable/calm_enable.html#adding-active-directory">Adding Active Directory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html">Calm: Windows Blueprint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#creating-blueprint-windows">Creating Blueprint (Windows)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#creating-blueprint">Creating Blueprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#setting-variables">Setting Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#adding-windows-service">Adding Windows Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#package-install">Package Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#package-uninstall">Package Uninstall</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#blueprint-launch-and-verification">Blueprint Launch and Verification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#launching-the-blueprint">Launching the Blueprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#verification">Verification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html">Kalm: WordPress Blueprint (Kubernetes)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#adding-kubernetes-provider">Adding Kubernetes provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#enabling-kubernetes-on-project">Enabling Kubernetes on project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#importing-blueprint-wordpress">Importing Blueprint (WordPress)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#configuring-blueprint-wordpress">Configuring Blueprint (WordPress)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#setting-variables">Setting Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#setting-pod-deployment-account">Setting Pod Deployment Account</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#launching-the-blueprint">Launching the Blueprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#scaling-out-wordpress">Scaling out WordPress</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html#takeaways">Takeaways</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Karbon 1.0</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../karbon/karbon.html">Karbon</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#creating-a-karbon-cluster">Creating a Karbon Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#getting-started-with-kubectl">Getting Started with Kubectl</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../karbon/karbon.html#cluster-and-client-version">Cluster and client version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../karbon/karbon.html#cluster-info">Cluster info</a></li>
<li class="toctree-l3"><a class="reference internal" href="../karbon/karbon.html#running-pods">Running pods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#deploying-an-application">Deploying an Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#accessing-wordpress">Accessing Wordpress</a></li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#exploring-logging-visualization">Exploring Logging &amp; Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#coming-soon">Coming Soon!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#takeaways">Takeaways</a></li>
<li class="toctree-l2"><a class="reference internal" href="../karbon/karbon.html#additional-kubernetes-training-resources">Additional Kubernetes Training Resources</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/glossary.html">Glossary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix/glossary.html#nutanix-core">Nutanix Core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#aos">AOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#pulse">Pulse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#prism-element">Prism Element</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#prism-central">Prism Central</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#node">Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#block">Block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#storage-pool">Storage Pool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#storage-container">Storage Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#anatomy-of-a-read-i-o">Anatomy of a Read I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/glossary.html#anatomy-of-a-write-i-o">Anatomy of a Write I/O</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><p class="caption"><span class="caption-text">Technology Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_nutanix/what_is_nutanix.html">What is Nutanix</a></li>
</ul>
<p class="caption"><span class="caption-text">Nutanix Calm</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_calm/what_is_calm.html">What Is Calm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calm_basics/basics.html">Calm Basics</a></li>
</ul>
<p class="caption"><span class="caption-text">Nutanix Calm Lab</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../calm_projects/calm_projects.html">Calm: Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calm_sshkey_creation/calm_sshkey_creation.html">Calm: SSH Key Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calm_singlevm_blueprint/calm_singlevm_blueprint.html">Calm: Single VM Blueprint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calm_mysql_blueprint/calm_mysql_blueprint.html">Calm: MySQL Blueprint</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Calm: 3TWA Blueprint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calm-blueprint-3twa">Calm Blueprint (3TWA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-web-server">Creating the Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-dependencies">Adding Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-replicas">Adding Replicas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-load-balancer">Creating the Load Balancer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scale-out">Scale Out</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scale-in">Scale In</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launching-and-managing-the-application">Launching and Managing the Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#takeaways">Takeaways</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calm_marketplace/calm_marketplace.html">Calm: Marketplace</a></li>
</ul>
<p class="caption"><span class="caption-text">Optional Flow Lab</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_flow/what_is_flow.html">What Is Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow_enable/flow_enable.html">Flow: Enable and Lab Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow_quarantine_vm/flow_quarantine_vm.html">Flow: Quarantine VM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow_isolate_environments/flow_isolate_environments.html">Flow: Isolate Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow_secure_app/flow_secure_app.html">Flow: Secure App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow_visualization/flow_visualization.html">Flow: Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">Optional Labs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../calm_enable/calm_enable.html">Calm: Enable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calm_windows_blueprint/calm_windows_blueprint.html">Calm: Windows Blueprint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kalm_wordpress_blueprint/kalm_wordpress_blueprint.html">Kalm: WordPress Blueprint (Kubernetes)</a></li>
</ul>
<p class="caption"><span class="caption-text">Karbon 1.0</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../karbon/karbon.html">Karbon</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="calm-3twa-blueprint">
<span id="calm-lamp-blueprint"></span><h1>Calm: 3TWA Blueprint<a class="headerlink" href="#calm-3twa-blueprint" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="calm-blueprint-3twa">
<h2>Calm Blueprint (3TWA)<a class="headerlink" href="#calm-blueprint-3twa" title="Permalink to this headline">¶</a></h2>
<p>In this exercise you will extend&nbsp;the MySQL Blueprint created previously into a basic 3 Tier Web Application (a Task Manager), as shown below.  You’ll also add the ability to perform Day 2 operations (scaling) to the blueprint.</p>
<div class="figure">
<img alt="../_images/3twa1.png" src="../_images/3twa1.png" />
</div>
<div class="section" id="creating-the-web-server">
<h3>Creating the Web Server<a class="headerlink" href="#creating-the-web-server" title="Permalink to this headline">¶</a></h3>
<p>From <strong>Prism Central &gt; Services &gt; Calm</strong>, select <strong>Blueprints</strong> from the sidebar and select your Blueprint from the previous exercise. An <strong>Action</strong> menu has been enabled on the top, click on it and <strong>Clone</strong> your blueprint.</p>
<p>Specify <strong>Calm3TWA&lt;INITIALS&gt;</strong> in the <strong>Blueprint Name</strong> field.</p>
<p>Click <strong>Clone</strong> to continue.</p>
<p>Select the MySQL service object, and create two clones of the deployment. Click twice on the clone deployment icon ( <img alt="clone-icon" src="../_images/clone_deployment_icon.png" /> )</p>
<div class="figure">
<img alt="../_images/3twa3.png" src="../_images/3twa3.png" />
</div>
<p>Choose one of the two new services to convert this into the WebServer. With the WebServer service icon selected in the workspace window, scroll to the top of the <strong>Configuration Panel</strong>, click <strong>VM</strong>.</p>
<p>Rename the following fields:</p>
<ul class="simple">
<li><strong>Service Name</strong> - WebServer</li>
<li><strong>Name</strong> - WebServerAHV</li>
<li><strong>VM Name</strong> - WEBSERVER-&#64;&#64;{calm_array_index}&#64;&#64;-&#64;&#64;{calm_time}&#64;&#64;</li>
</ul>
<p>Click <strong>Save</strong> and ensure no errors or warnings pop-up.  If they do, resolve the issue, and <strong>Save</strong> again.</p>
<p>With the WebServer service icon selected in the workspace window, scroll to the top of the <strong>Configuration Panel</strong>, click <strong>Package</strong>.  Rename the Package to <strong>WEBSERVER_PACKAGE</strong>, and then click the <strong>Configure install</strong> button.</p>
<p>On the Blueprint Canvas section, click on the existing task in the <strong>Package Install</strong> field and update all the fields on the <strong>Configuration Panel</strong> on the right with:</p>
<ul class="simple">
<li><strong>Name Task</strong> - Install_webserver</li>
<li><strong>Type</strong> - Execute</li>
<li><strong>Script Type</strong> - Shell</li>
<li><strong>Credential</strong> - CENTOS</li>
</ul>
<p>Replace the existing script with the next one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span> -ex

sudo yum update -y
sudo yum -y install epel-release
sudo setenforce <span class="m">0</span>
sudo sed -i <span class="s1">&#39;s/enforcing/disabled/g&#39;</span> /etc/selinux/config /etc/selinux/config
sudo systemctl stop firewalld <span class="o">||</span> <span class="nb">true</span>
sudo systemctl disable firewalld <span class="o">||</span> <span class="nb">true</span>
sudo rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
sudo yum update -y
sudo yum install -y nginx php56w-fpm php56w-cli php56w-mcrypt php56w-mysql php56w-mbstring php56w-dom git unzip

sudo mkdir -p /var/www/laravel
<span class="nb">echo</span> <span class="s2">&quot;server {</span>
<span class="s2"> listen 80 default_server;</span>
<span class="s2"> listen [::]:80 default_server ipv6only=on;</span>
<span class="s2">root /var/www/laravel/public/;</span>
<span class="s2"> index index.php index.html index.htm;</span>
<span class="s2">location / {</span>
<span class="s2"> try_files \$uri \$uri/ /index.php?\$query_string;</span>
<span class="s2"> }</span>
<span class="s2"> # pass the PHP scripts to FastCGI server listening on /var/run/php5-fpm.sock</span>
<span class="s2"> location ~ \.php</span>$<span class="s2"> {</span>
<span class="s2"> try_files \$uri /index.php =404;</span>
<span class="s2"> fastcgi_split_path_info ^(.+\.php)(/.+)\$;</span>
<span class="s2"> fastcgi_pass 127.0.0.1:9000;</span>
<span class="s2"> fastcgi_index index.php;</span>
<span class="s2"> fastcgi_param SCRIPT_FILENAME \$document_root\$fastcgi_script_name;</span>
<span class="s2"> include fastcgi_params;</span>
<span class="s2"> }</span>
<span class="s2">}&quot;</span> <span class="p">|</span> sudo tee /etc/nginx/conf.d/laravel.conf
sudo sed -i <span class="s1">&#39;s/80 default_server/80/g&#39;</span> /etc/nginx/nginx.conf
<span class="k">if</span> <span class="sb">`</span>grep <span class="s2">&quot;cgi.fix_pathinfo&quot;</span> /etc/php.ini<span class="sb">`</span> <span class="p">;</span> <span class="k">then</span>
 sudo sed -i <span class="s1">&#39;s/cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/&#39;</span> /etc/php.ini
<span class="k">else</span>
 sudo sed -i <span class="s1">&#39;s/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/&#39;</span> /etc/php.ini
<span class="k">fi</span>

sudo systemctl <span class="nb">enable</span> php-fpm
sudo systemctl <span class="nb">enable</span> nginx
sudo systemctl restart php-fpm
sudo systemctl restart nginx

<span class="k">if</span> <span class="o">[</span> ! -e /usr/local/bin/composer <span class="o">]</span>
<span class="k">then</span>
 curl -sS https://getcomposer.org/installer <span class="p">|</span> php
 sudo mv composer.phar /usr/local/bin/composer
 sudo chmod +x /usr/local/bin/composer
<span class="k">fi</span>

sudo git clone https://github.com/pipoe2h/quickstart-basic.git /var/www/laravel
sudo sed -i <span class="s1">&#39;s/DB_HOST=.*/DB_HOST=@@{MySQL.address}@@/&#39;</span> /var/www/laravel/.env

sudo su - -c <span class="s2">&quot;cd /var/www/laravel; composer install&quot;</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;@@{calm_array_index}@@&quot;</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 sudo su - -c <span class="s2">&quot;cd /var/www/laravel; php artisan migrate&quot;</span>
<span class="k">fi</span>

sudo chown -R nginx:nginx /var/www/laravel
sudo chmod -R <span class="m">777</span> /var/www/laravel/
sudo systemctl restart nginx
</pre></div>
</div>
<div class="figure">
<img alt="../_images/3twa4.png" src="../_images/3twa4.png" />
</div>
<p>Select the WebServer service icon in the workspace window again and scroll to the top of the <strong>Configuration Panel</strong>, click <strong>Package</strong>, and then click the <strong>Configure uninstall</strong> button.</p>
<p>On the Blueprint Canvas section, click on the existing task in the <strong>Package Uninstall</strong> field and update all the fields on the <strong>Configuration Panel</strong> on the right with:</p>
<ul class="simple">
<li><strong>Name Task</strong> - Uninstall_webserver</li>
<li><strong>Type</strong> - Execute</li>
<li><strong>Script Type</strong> - Shell</li>
<li><strong>Credential</strong> - CENTOS</li>
</ul>
<p>Replace the existing script with the next one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span> -ex

sudo rm -rf /var/www/laravel
sudo yum erase -y nginx
</pre></div>
</div>
<div class="figure">
<img alt="../_images/3twa5.png" src="../_images/3twa5.png" />
</div>
<p>Click <strong>Save</strong> and ensure no errors or warnings pop-up.  If they do, resolve the issue, and <strong>Save</strong> again.</p>
</div>
<div class="section" id="adding-dependencies">
<h3>Adding Dependencies<a class="headerlink" href="#adding-dependencies" title="Permalink to this headline">¶</a></h3>
<p>As our application will require the database to be running before the web server starts, our Blueprint requires a dependency to enforce this ordering. There are a couple of ways to do this, one of which we’ve already done without likely realizing it. If you didn’t save after the last step, be sure to do that first.</p>
<p>In the <strong>Application Overview &gt; Application Profile</strong> section, expand the <strong>Default</strong> Application Profile (if you renamed the Application Profile at a previous step, then just select that re-named application profile). Next, click on the <strong>Create</strong> Profile Action and view the <strong>Workspace</strong>:</p>
<div class="figure">
<img alt="../_images/dependency1.png" src="../_images/dependency1.png" />
</div>
<p>Take note of the <strong>Orange Orchestration Edge</strong> going from the <strong>MySQL Start</strong> task to the <strong>WebServer Package Install</strong> task.  This edge was automatically created by Calm due to the <strong>&#64;&#64;{MySQL.address}&#64;&#64;</strong> macro reference in the <strong>WebServer Package Install</strong> task.  Since the system needs to know the IP Address of the MySQL service prior to being able to proceed with the WebServer Install task, it automatically creates the orchestration edge.  This requires the MySQL service to be started prior to moving on to the WebServer Install task.</p>
<p>Next, back in the <strong>Application Overview &gt; Application Profile</strong> section, select the <strong>Stop</strong> Profile Action.  View the <strong>Workplace</strong> section: notice how there are no orange orchestration edges?  This could cause issues if the MySQL service shutdown slightly before the WebServer accepted a request.  Click on each Profile Action to take note of the current presence (or lack thereof) of the orange orchestration edges.</p>
<div class="figure">
<img alt="../_images/dependency2.png" src="../_images/dependency2.png" />
</div>
<p>To resolve this, we’ll manually create a dependency.  In the <strong>Workspace</strong>, select the <strong>WebServer</strong> Service and click the <strong>Create Dependency</strong> icon that appears above the Service icon, and then click on the <strong>MySQL</strong> service.  This represents that the <strong>WebServer</strong> service “depends” upon the <strong>MySQL</strong> service, meaning the <strong>MySQL</strong> service will start before, and stop after, the <strong>WebServer</strong> service.</p>
<p>Click <strong>Save</strong>.  You should see the system draw an <strong>Orange Orchestration Edge</strong> like so:</p>
<div class="figure">
<img alt="../_images/dependency3.png" src="../_images/dependency3.png" />
</div>
<p>Drawing the white dependency arrows will cause Calm to create orange orchestration edges for all <strong>System Defined Profile Actions</strong> (Create, Start, Restart, Stop, Delete, and Soft Delete).  Click on each Profile Action to see the difference compared to before the white dependency arrow was drawn.</p>
</div>
<div class="section" id="adding-replicas">
<h3>Adding Replicas<a class="headerlink" href="#adding-replicas" title="Permalink to this headline">¶</a></h3>
<p>Calm makes it simple to add multiple copies of a given Service, which is helpful for scale out workloads such as web servers.</p>
<p>In the <strong>Workspace</strong>, select the <strong>WebServer</strong> Service.</p>
<p>In the <strong>Configuration Pane</strong>, select the <strong>Service</strong> tab.</p>
<p>Under <strong>Deployment Config</strong>, change the <strong>Min</strong> number of replicas from 1 to 2, and the <strong>Max</strong> Number of replicas from 1 to 4.</p>
<div class="figure">
<img alt="../_images/replicas.png" src="../_images/replicas.png" />
</div>
</div>
<div class="section" id="creating-the-load-balancer">
<h3>Creating the Load Balancer<a class="headerlink" href="#creating-the-load-balancer" title="Permalink to this headline">¶</a></h3>
<p>To take advantage of a scale out web tier our application needs to be able to load balance connections across multiple web server VMs. HAProxy is a free, open source TCP/HTTP load balancer used to distribute workloads across multiple servers. It can be used in small, simple deployments and large web-scale environments such as GitHub, Instagram, and Twitter.</p>
<p>Select the remaining cloned service to convert this into the HAProxy load balancer. With the HAProxy service icon selected in the workspace window, scroll to the top of the <strong>Configuration Panel</strong>, click <strong>VM</strong>.</p>
<p>Rename the following fields:</p>
<ul class="simple">
<li><strong>Service Name</strong> - HAProxy</li>
<li><strong>Name</strong> - HAProxyAHV</li>
<li><strong>VM Name</strong> - HAPROXY-&#64;&#64;{calm_array_index}&#64;&#64;-&#64;&#64;{calm_time}&#64;&#64;</li>
</ul>
<p>Click <strong>Save</strong> and ensure no errors or warnings pop-up.  If they do, resolve the issue, and <strong>Save</strong> again.</p>
<p>With the WebServer service icon selected in the workspace window, scroll to the top of the <strong>Configuration Panel</strong>, click <strong>Package</strong>.  Rename the Package to <strong>HAPROXY_PACKAGE</strong>, and then click the <strong>Configure install</strong> button.</p>
<p>On the Blueprint Canvas section, click on the existing task in the <strong>Package Install</strong> field and update all the fields on the <strong>Configuration Panel</strong> on the right with:</p>
<ul class="simple">
<li><strong>Name Task</strong> - Install_haproxy</li>
<li><strong>Type</strong> - Execute</li>
<li><strong>Script Type</strong> - Shell</li>
<li><strong>Credential</strong> - CENTOS</li>
</ul>
<p>Replace the existing script with the next one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span> -ex

sudo yum update -y
sudo yum install -y haproxy
sudo setenforce <span class="m">0</span>
sudo sed -i <span class="s1">&#39;s/enforcing/disabled/g&#39;</span> /etc/selinux/config /etc/selinux/config
sudo systemctl stop firewalld <span class="o">||</span> <span class="nb">true</span>
sudo systemctl disable firewalld <span class="o">||</span> <span class="nb">true</span>

<span class="nb">echo</span> <span class="s2">&quot;global</span>
<span class="s2"> log 127.0.0.1 local0</span>
<span class="s2"> log 127.0.0.1 local1 notice</span>
<span class="s2"> maxconn 4096</span>
<span class="s2"> quiet</span>
<span class="s2"> user haproxy</span>
<span class="s2"> group haproxy</span>
<span class="s2">defaults</span>
<span class="s2"> log global</span>
<span class="s2"> mode http</span>
<span class="s2"> retries 3</span>
<span class="s2"> timeout client 50s</span>
<span class="s2"> timeout connect 5s</span>
<span class="s2"> timeout server 50s</span>
<span class="s2"> option dontlognull</span>
<span class="s2"> option httplog</span>
<span class="s2"> option redispatch</span>
<span class="s2"> balance roundrobin</span>
<span class="s2"># Set up application listeners here.</span>
<span class="s2">listen admin</span>
<span class="s2"> bind 0.0.0.0:9000</span>
<span class="s2"> mode http</span>
<span class="s2"> stats uri /</span>
<span class="s2">frontend http</span>
<span class="s2"> maxconn 2000</span>
<span class="s2"> bind 0.0.0.0:80</span>
<span class="s2"> default_backend servers-http</span>
<span class="s2">backend servers-http&quot;</span> <span class="p">|</span> sudo tee /etc/haproxy/haproxy.cfg

<span class="nv">hosts</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;@@{WebServer.address}@@&quot;</span> <span class="p">|</span> tr <span class="s2">&quot;,&quot;</span> <span class="s2">&quot;\n&quot;</span><span class="k">)</span>
<span class="nv">port</span><span class="o">=</span><span class="m">80</span>

<span class="k">for</span> host in <span class="nv">$hosts</span>
  <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&quot; server host-</span><span class="si">${</span><span class="nv">host</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">host</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2"> weight 1 maxconn 100 check&quot;</span> <span class="p">|</span> sudo tee -a /etc/haproxy/haproxy.cfg
<span class="k">done</span>

sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> haproxy
sudo systemctl restart haproxy
</pre></div>
</div>
<div class="figure">
<img alt="../_images/3twa6.png" src="../_images/3twa6.png" />
</div>
<p>Select the HAProxy service icon in the workspace window again and scroll to the top of the <strong>Configuration Panel</strong>, click <strong>Package</strong>, and then click the <strong>Configure uninstall</strong> button.</p>
<p>On the Blueprint Canvas section, click on the existing task in the <strong>Package Uninstall</strong> field and update all the fields on the <strong>Configuration Panel</strong> on the right with:</p>
<ul class="simple">
<li><strong>Name Task</strong> - Uninstall_haproxy</li>
<li><strong>Type</strong> - Execute</li>
<li><strong>Script Type</strong> - Shell</li>
<li><strong>Credential</strong> - CENTOS</li>
</ul>
<p>Replace the existing script with the next one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span> -ex

sudo
yum -y erase haproxy
</pre></div>
</div>
<p>Click <strong>Save</strong>.</p>
<div class="figure">
<img alt="../_images/3twa7.png" src="../_images/3twa7.png" />
</div>
<p>In the <strong>Workspace</strong>, select the <strong>HAProxy</strong> Service and click the <strong>Create Dependency</strong> icon that appears above the Service icon.  Select the <strong>WebServer</strong> Service.</p>
<div class="figure">
<img alt="../_images/dependency4.png" src="../_images/dependency4.png" />
</div>
<p>Click <strong>Save</strong> and ensure no errors or warnings pop-up.  If they do, resolve the issue, and <strong>Save</strong> again.</p>
</div>
<div class="section" id="scale-out">
<h3>Scale Out<a class="headerlink" href="#scale-out" title="Permalink to this headline">¶</a></h3>
<p>Imagine you’re the administrator of the Task Manager Application that we’ve been building, and you’re currently unsure of the amount of demand for this application by your end users.  Or imagine you expect the demand to ebb and flow due to the time of the year.  How can we easily scale to meet this changing demand?</p>
<p>If you recall in a previous step, we set the minimum number of <strong>WebServer</strong> replicas to 2, and our maximum to 4.  In current versions of Calm, the minimum number is always the starting point.  In the event our default 2 replicas of our <strong>WebServer</strong> web server is not enough to handle the load of your end users, we can perform a <strong>Scale Out</strong> Action.</p>
<p>In the <strong>Application Overview &gt; Application Profile</strong> section, expand the <strong>Default</strong> Application Profile.  Then, select <em class="fa fa-plus-circle"></em> next to the <strong>Actions</strong> section.  On the <strong>Configuration Panel</strong> to the right, rename the new Action to be <strong>Scale Out</strong>.</p>
<div class="figure">
<img alt="../_images/scaleout1.png" src="../_images/scaleout1.png" />
</div>
<p>At the bottom outside of the <strong>WebServer</strong> service tile, click the <strong>+ Task</strong> button, then fill out the following fields:</p>
<ul class="simple">
<li><strong>Task Name</strong> - web_scale_out</li>
<li><strong>Type</strong> - Scaling</li>
<li><strong>Scaling Type</strong> - Scale Out</li>
<li><strong>Scaling Count</strong> - 1</li>
</ul>
<div class="figure">
<img alt="../_images/scaleout2.png" src="../_images/scaleout2.png" />
</div>
<p>Click <strong>Save</strong> and ensure no errors or warnings pop-up.  If they do, resolve the issue, and <strong>Save</strong> again.</p>
<p>When a user later runs the <strong>Scale Out</strong> task, a new <strong>WebServer</strong> VM will get created, and the <strong>Package Install</strong> tasks for that service will be exectured.  However, we do need to modify the <strong>HAProxy</strong> configuration in order to start taking advantage of this new web server.</p>
<p>At the bottom of the <strong>HAProxy</strong> service tile, click the <strong>+ Task</strong> button, then fill out the following fields:</p>
<ul class="simple">
<li><strong>Task Name</strong> - add_webserver</li>
<li><strong>Type</strong> - Execute</li>
<li><strong>Script Type</strong> - Shell</li>
<li><strong>Credential</strong> - CENTOS</li>
</ul>
<p>Copy and paste the following script into the <strong>Script</strong> field:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span> -ex

<span class="nv">host</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;@@{WebServer.address}@@&quot;</span> <span class="p">|</span> awk -F <span class="s2">&quot;,&quot;</span> <span class="s1">&#39;{print $NF}&#39;</span><span class="k">)</span>
<span class="nv">port</span><span class="o">=</span><span class="m">80</span>
<span class="nb">echo</span> <span class="s2">&quot; server host-</span><span class="si">${</span><span class="nv">host</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">host</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">port</span><span class="si">}</span><span class="s2"> weight 1 maxconn 100 check&quot;</span> <span class="p">|</span> sudo tee -a /etc/haproxy/haproxy.cfg

sudo systemctl daemon-reload
sudo systemctl restart haproxy
</pre></div>
</div>
<p>That script will grab the last address in the WebServer address array, and add it to the haproxy.cfg file.  However, we want to be sure that this doesn’t happen until <strong>after</strong> the new WebServer is fully up, otherwise the HAProxy server may send requests to a non-functioning WebServer.</p>
<p>To solve this issue, on the <strong>Workspace</strong>, click on the <strong>web_scale_out</strong> task, then the <strong>Create Edge</strong> arrow icon, and finally click on the <strong>add_webserver</strong> task to draw the edge.  Afterwards your <strong>Workspace</strong> should look like this:</p>
<div class="figure">
<img alt="../_images/scaleout3.png" src="../_images/scaleout3.png" />
</div>
</div>
<div class="section" id="scale-in">
<h3>Scale In<a class="headerlink" href="#scale-in" title="Permalink to this headline">¶</a></h3>
<p>Again imagine you’re the administrator of this Task Manager Application we’re building.  It’s the end of your busy season, and you’d like to scale the Web Server back in to save on resource utilization.  To accomplish this, navigate to the <strong>Application Overview &gt; Application Profile</strong> section, expand the <strong>Default</strong> Application Profile.  Then, select <em class="fa fa-plus-circle"></em> next to the <strong>Actions</strong> section.  On the <strong>Configuration Panel</strong> to the right, rename the new Action to be <strong>Scale In</strong>.</p>
<div class="figure">
<img alt="../_images/scalein1.png" src="../_images/scalein1.png" />
</div>
<p>At the bottom outside of the <strong>WebServer</strong> service tile, click the <strong>+ Task</strong> button, then fill out the following fields:</p>
<ul class="simple">
<li><strong>Task Name</strong> - web_scale_in</li>
<li><strong>Type</strong> - Scaling</li>
<li><strong>Scaling Type</strong> - Scale In</li>
<li><strong>Scaling Count</strong> - 1</li>
</ul>
<div class="figure">
<img alt="../_images/scalein2.png" src="../_images/scalein2.png" />
</div>
<p>Click <strong>Save</strong> and ensure no errors or warnings pop-up.  If they do, resolve the issue, and <strong>Save</strong> again.</p>
<p>When a user later runs the <strong>Scale In</strong> task, the last <strong>WebServer</strong> replica will have its <strong>Package Uninstall</strong> task run, the VM will be shut down, and then deleted, which will reclaim resources.  However, we do need to modify the <strong>HAProxy</strong> configuration to ensure that we’re no longer sending traffic to the to-be-deleted Web Server.</p>
<p>At the bottom of the <strong>HAProxy</strong> service tile, click the <strong>+ Task</strong> button, then fill out the following fields:</p>
<ul class="simple">
<li><strong>Task Name</strong> - del_webserver</li>
<li><strong>Type</strong> - Execute</li>
<li><strong>Script Type</strong> - Shell</li>
<li><strong>Credential</strong> - CENTOS</li>
</ul>
<p>Copy and paste the following script into the <strong>Script</strong> field:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span> -ex

<span class="nv">host</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;@@{WebServer.address}@@&quot;</span> <span class="p">|</span> awk -F <span class="s2">&quot;,&quot;</span> <span class="s1">&#39;{print $NF}&#39;</span><span class="k">)</span>
sudo sed -i <span class="s1">&#39;/$host/d&#39;</span> /etc/haproxy/haproxy.cfg

sudo systemctl daemon-reload
sudo systemctl restart haproxy
</pre></div>
</div>
<p>That script will grab the last address in the WebServer address array, and remove it from the haproxy.cfg file.  Similar to the last step, we want to be sure that this happens <strong>before</strong> the new WebServer is destroyed, otherwise the HAProxy server may send requests to a non-functioning WebServer.</p>
<p>To solve this issue, on the <strong>Workspace</strong>, click on the <strong>del_webserver</strong> task, then the <strong>Create Edge</strong> arrow icon, and finally click on the <strong>web_scale_in</strong> task to draw the edge.  Afterwards your <strong>Workspace</strong> should look like this:</p>
<div class="figure">
<img alt="../_images/scalein3.png" src="../_images/scalein3.png" />
</div>
<p>Click <strong>Save</strong> and ensure no errors or warnings pop-up.  If they do, resolve the issue, and <strong>Save</strong> again.</p>
</div>
<div class="section" id="launching-and-managing-the-application">
<h3>Launching and Managing the Application<a class="headerlink" href="#launching-and-managing-the-application" title="Permalink to this headline">¶</a></h3>
<p>Within the blueprint editor, click <strong>Launch</strong>. Specify a unique <strong>Application Name</strong> (e.g. Calm3TWA*&lt;INITIALS&gt;*-2) and click <strong>Create</strong>.  Monitor the application as it deploys.</p>
<p>Once the application changes into a <strong>RUNNING</strong> state, navigate to the <strong>Services</strong> tab and select the <strong>HAProxy</strong> service.  On the panel that pops open on the right, highlight and copy the <strong>IP Address</strong> field.  In a new browser tab or window, navigate to <a class="reference external" href="http:/">http:/</a>/&lt;HAProxy-IP&gt;, and test out your Task Manager Web Application.</p>
<div class="figure">
<img alt="../_images/3twa2.png" src="../_images/3twa2.png" />
</div>
<p>Now, back within Calm, navigate to the <strong>Manage</strong> tab, and click the play button next to the <strong>Scale Out</strong> task, and click <strong>Run</strong> to Scale out the Web Server.  Monitor the Scale Out action on the <strong>Audit</strong> tab.</p>
</div>
</div>
<div class="section" id="takeaways">
<h2>Takeaways<a class="headerlink" href="#takeaways" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Applications typically span across multiple VMs, each responsible for different services. Calm is capable of automated and orchestrating full applications.</li>
<li>Dependencies between services can be easily modeled in the Blueprint Editor.</li>
<li>Users can quickly provision entire application stacks for production or testing for repeatable results without time lost to manual configuration.</li>
<li>Day 2 operations such as scaling can also be easily modeled, allowing administrators to manage an application for months or years.</li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/calm_3twa_blueprint/calm_3twa_blueprint.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2019 Nutanix.<br/>
    </p>
  </div>
</footer>
  </body>
</html>